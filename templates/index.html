<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Health Care AI Assistant</title>

  <!-- Bootstrap 5 CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f9f9f9;
      margin: 0;
      padding: 0;
      height: 100vh;
      overflow: hidden;
    }

    /* Sidebar */
    .sidebar {
      position: fixed;
      top: 0;
      left: -220px;
      width: 200px;
      height: 100%;
      background: #fff;
      box-shadow: 2px 0 10px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      gap: 1rem;
      padding-top: 60px;
      transition: left 0.3s;
      z-index: 100;
    }

    .sidebar.show {
      left: 0;
    }

    .sidebar button {
      width: 90%;
      margin: 0 auto;
    }

    /* Sidebar toggle */
    .sidebar-toggle {
      position: fixed;
      top: 10px;
      left: 10px;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: #4caf50;
      color: white;
      border: none;
      font-weight: bold;
      cursor: pointer;
      z-index: 101;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
    }

    /* Chat container */
    .chat-container {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 95%;
      max-width: 800px;
      height: 90vh;
      background: white;
      border-radius: 20px;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
      z-index: 50;
    }

    .chat-header {
      background: white;
      padding: 12px 20px;
      font-size: 1.1rem;
      font-weight: 600;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    }

    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 15px;
      background: #fefefe;
    }

    .chat-input {
      padding: 10px 15px;
      border-top: 1px solid #ddd;
      background: #fff;
    }

    .lang-btn {
      font-size: 0.85rem;
      padding: 4px 10px;
      border-radius: 12px;
      background: #f0f0f0;
      border: none;
      cursor: pointer;
      transition: 0.2s;
    }

    .lang-btn.active {
      background: #4caf50;
      color: white;
    }

    .note-text {
      font-size: 0.85rem;
      color: #666;
      margin-top: 6px;
      text-align: center;
    }

    .message {
      max-width: 75%;
      margin-bottom: 10px;
      padding: 10px 15px;
      border-radius: 20px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
      word-wrap: break-word;
    }

    .message.user {
      background: #dcfce7;
      color: #065f46;
      margin-left: auto;
    }

    .message.bot {
      background: #f3f4f6;
      color: #111827;
      margin-right: auto;
    }
  </style>
</head>
<body>

  <!-- Sidebar -->
  <div class="sidebar" id="sidebar">
    <button class="btn btn-outline-success" onclick="openModal('alertsModal')">Regional Alerts</button>
    <button class="btn btn-outline-success" onclick="openModal('schemesModal')">Policies & Schemes</button>
    <button class="btn btn-outline-success" onclick="openModal('faqModal')">FAQs</button>
  </div>

  <!-- Sidebar toggle -->
  <button class="sidebar-toggle" onclick="toggleSidebar()">‚ò∞</button>

  <!-- Chat container -->
  <div class="chat-container">
    <div class="chat-header">
      <span>Health Care AI Assistant</span>
      <div class="flex gap-2">
        <button class="lang-btn active" onclick="setLanguage('English')">English</button>
        <button class="lang-btn" onclick="setLanguage('Hindi')">‡§π‡§ø‡§Ç‡§¶‡•Ä</button>
        <button class="lang-btn" onclick="setLanguage('Telugu')">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</button>
        <button class="lang-btn" onclick="setLanguage('Odia')">‡¨ì‡¨°‡¨º‡¨ø‡¨Ü</button>
      </div>
    </div>

    <div class="chat-messages" id="chatBox">
      <div class="message bot">
        Hello üëã I‚Äôm your health care assistant. How can I help you today?
      </div>
    </div>

    <div class="chat-input">
      <form onsubmit="handleMessage(event)" class="d-flex gap-2">
        <input type="text" id="userInput" class="form-control flex-1 rounded-lg border-gray-300 focus:ring-2 focus:ring-green-500 focus:outline-none" placeholder="Type your message..." required>
        <button type="submit" class="btn btn-success px-4 py-2 rounded-lg">Send</button>
      </form>
      <p class="note-text"> Note: Physical illnesses can also affect your mental health. Take care of both üíö</p>
    </div>
  </div>

  <!-- Alerts Modal -->
  <div class="modal fade" id="alertsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content p-4">
        <h5 class="modal-title mb-3">Regional Health Alerts</h5>
        <div class="d-flex gap-2 mb-3">
          <button class="btn btn-outline-primary" onclick="getRegionContent('alerts','telangana')">Telangana</button>
          <button class="btn btn-outline-primary" onclick="getRegionContent('alerts','odisha')">Odisha</button>
        </div>
        <div id="alertsContent">Click a region to view alerts</div>
      </div>
    </div>
  </div>

  <!-- Schemes Modal -->
  <div class="modal fade" id="schemesModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content p-4">
        <h5 class="modal-title mb-3">Policies & Schemes</h5>
        <div class="d-flex gap-2 mb-3">
          <button class="btn btn-outline-primary" onclick="getRegionContent('schemes','telangana')">Telangana</button>
          <button class="btn btn-outline-primary" onclick="getRegionContent('schemes','odisha')">Odisha</button>
        </div>
        <div id="schemesContent">Click a region to view policies/schemes</div>
      </div>
    </div>
  </div>

  <!-- FAQ Modal -->
  <div class="modal fade" id="faqModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content p-4">
        <h5 class="modal-title mb-3">FAQs</h5>
        <div id="faqContent">Click the button to load FAQs</div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    let selectedLanguage = "English";

    function toggleSidebar() {
      document.getElementById("sidebar").classList.toggle("show");
    }

    function setLanguage(lang) {
      selectedLanguage = lang;
      document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
    }

    async function handleMessage(e) {
      e.preventDefault();
      const input = document.getElementById('userInput');
      const chatBox = document.getElementById('chatBox');

      const userMessage = document.createElement('div');
      userMessage.className = 'message user';
      userMessage.textContent = input.value;
      chatBox.appendChild(userMessage);
      chatBox.scrollTop = chatBox.scrollHeight;

      const loadingMessage = document.createElement('div');
      loadingMessage.className = 'message bot';
      loadingMessage.textContent = "‚è≥ Thinking...";
      chatBox.appendChild(loadingMessage);
      chatBox.scrollTop = chatBox.scrollHeight;

      try {
        const response = await fetch("/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message: input.value, language: selectedLanguage })
        });

        const data = await response.json();
        chatBox.removeChild(loadingMessage);

        const botMessage = document.createElement('div');
        botMessage.className = 'message bot';
        botMessage.textContent = data.response || "No response from AI.";
        chatBox.appendChild(botMessage);
        chatBox.scrollTop = chatBox.scrollHeight;
      } catch (error) {
        chatBox.removeChild(loadingMessage);
        const errorMessage = document.createElement('div');
        errorMessage.className = 'message bot';
        errorMessage.style.background = "#fee2e2";
        errorMessage.style.color = "#b91c1c";
        errorMessage.textContent = "Error connecting to server. Please try again.";
        chatBox.appendChild(errorMessage);
        chatBox.scrollTop = chatBox.scrollHeight;
      }

      input.value = '';
    }

    function openModal(modalId) {
      const modal = new bootstrap.Modal(document.getElementById(modalId));
      modal.show();
    }

    async function getRegionContent(type, region) {
      let contentId = type + "Content";

      const res = await fetch("/updates", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ type, region })
      });

      const data = await res.json();
      document.getElementById(contentId).innerHTML = data.response;
    }

    // Load FAQ when modal opens
    document.getElementById('faqModal').addEventListener('shown.bs.modal', async () => {
      const res = await fetch("/updates", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ type: 'faq' })
      });
      const data = await res.json();
      document.getElementById('faqContent').innerHTML = data.response;
    });
  </script>
</body>
</html>
